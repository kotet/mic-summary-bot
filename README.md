# mic-summary-bot

## 概要

このbotは総務省が公開するホームページ新着情報（RSSフィード）を監視し、議事録等のPDF資料を自動で取得します。
取得した資料はGoogle Gemini APIを用いて要約され、その要約結果はMastodonに定期的に自動投稿されます。
ライブラリとして実装されており、定期実行は外部のスケジューラ（cronなど）を利用することを想定しています。
`examples/main.go` にはcronを利用した実行例があります。

## 機能

### 1. RSSフィードの取得と解析
総務省のRSSフィード（`https://www.soumu.go.jp/news.rdf`）を定期的に取得し、新しいアイテムを検出します。RSSアイテムのURLをキーとして、処理状態（未処理、先送り、処理済み）をSQLite3データベースで管理し、重複投稿を防ぎます。

### 2. 対象ページのファイルダウンロード
RSSアイテムに紐づくWebページから、Geminiが直接処理可能なファイル（主にPDF）を抽出・ダウンロードします。
ダウンロードされたファイルは一時ディレクトリに保存され、処理後に削除されます。

### 3. Gemini APIによる要約生成と判定

Geminiに対して「要約する価値がある」「価値がない」「まだページが完成していない」の3つのステータスを判定させ、その結果に基づいて要約の実行を制御します。
ダウンロードしたファイル（またはファイル情報）をGoogle Gemini APIに送信し、要約を生成します。

### 4. Mastodonへの自動投稿
要約結果を指定されたMastodonインスタンスに自動投稿します。投稿にはRSSアイテムのタイトル、要約、元URLが含まれます。

## セットアップ

### 1. Goのインストール
Go 1.24.3以上がインストールされていることを確認してください。

### 2. 依存関係の取得
プロジェクトルートで以下のコマンドを実行し、必要なGoモジュールをダウンロードします。

```bash
go mod tidy
```

### 3. 設定ファイルの準備
`mic_summary_bot/config.example.yaml` を `config.yaml` としてコピーし、環境に合わせて編集してください。

### 4. APIキーの設定
`config.yaml` にGemini APIキーとMastodonアクセストークンを設定してください。

## サンプルのビルドと実行

プロジェクトルートで `Makefile` を使用してビルドおよび実行します。

### ビルド
```bash
make all
```
これにより、`examples-bot` という実行可能ファイルが生成されます。

### 実行
```bash
make run
```
`examples-bot` が実行され、Botが動作を開始します。

## テスト

プロジェクトのテストは `Makefile` を使用して実行できます。

### 標準テスト
```bash
make test
```

### 静的解析 (vet)
```bash
make lint
```

### 統合テスト (integration)

Gemini APIを利用するテストを実行します。環境変数の設定が必要です。

```bash
make test-full
```
