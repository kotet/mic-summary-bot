# Mic Summary Bot 開発ガイドライン

## 概要

このプロジェクトは、総務省が公開する新着情報RSSフィードを監視し、関連するPDF資料をGemini APIで要約してMastodonに自動投稿するGo言語製のBotです。

- **設定:**
    - Botの設定は `config.yaml` で行います。設定ファイルのサンプルとして `mic_summary_bot/config.example.yaml` が提供されています。

## 開発ガイドライン

- **言語:** 応答は日本語でお願いします。
- **設計ドキュメント:** 開発に着手する前に、必ず `docs/` ディレクトリ内の設計ドキュメントを確認してください。特に `requirements-definition.md` には本プロジェクトの要件が詳細に記載されています。
- **開発言語:** 開発にはGo言語を使用してください。Goの慣習（効果的な命名、シンプルさ、ゼロ値の活用など）に従ってください。
- **ビルド:** ビルドに関するタスクにはすべて `make` を使用してください。Goのビルドコマンドを直接実行しないでください。
- **Git:** コミットはユーザーが管理します。情報を取得する目的以外でgitコマンドを使用しないでください。
- **データベース:** Botは処理するRSSアイテムの状態をSQLiteデータベースで管理します。テーブル設計の詳細は `docs/db-table.md` を参照してください。
- **コード生成、セットアップや設定手順、ライブラリ/APIドキュメントが必要な場合は必ずContext7を使用する** – 明示的なリクエストが無くてもContext7 MCPツールを使用してライブラリIDを解決しドキュメントを取得する
- 仕様に問題や矛盾がある場合、または複数の実装方法が考えられる場合は、勝手に判断せずユーザーに質問する
- 行動する際はガイドラインを確認し、状況に応じて該当するガイドラインの内容をユーザーに宣言したうえで行動する
- **コマンド実行:** `make` などのコマンド実行ツールを使用する際、ユーザーへの事前確認は不要です。ツール側の確認機能で十分です。ただし、ファイルシステムを大幅に変更する、あるいはコストがかかる可能性のあるコマンド（例: `make clean`, APIを呼び出すテストの実行など）については、その操作の内容と潜在的な影響を簡潔に説明してから実行してください。

### Goコードガイドライン

- **コード品質:**
    - **予測可能なデフォルト:** このツールはユーザーを驚かせるような挙動をすべきではありません。
    - **ドキュメント:** 新機能はすべて、コードコメントと `README.md` の両方に記載してください。
    - **エッジケースの考慮:** 空の入力、ファイルの欠損、権限エラーなどのエッジケースを考慮してください。
    - **既存コードとの整合性:** 特に必要がない限り、既存のコードベースの設計や思想に合わせて機能を実装してください。
    - **後方互換性:** 構造や関数のシグネチャを変更する場合は、古いバージョンを完全に置き換えてください。明示的に要求されない限り、後方互換性のために非推奨の関数を残さないでください。
    - **賢さよりも予測可能性:** 巧妙なコードよりも、予測可能でわかりやすいコードの方が価値があります。
- **依存関係:**
    - 新しい依存関係を追加する場合は `go get` を使用し、`go.mod` と `go.sum` を更新してください。
- **主要なライブラリ:**
    - **Gemini API:** `google.golang.org/genai`
    - **Mastodon:** `github.com/mattn/go-mastodon`
    - **SQLite:** `glebarez/go-sqlite`

#### テストガイドライン

- **テスト:**
    - 通常のテストを実行するには `make test` を使用してください。
    - `go vet ./...` を使って、コードに一般的な誤りがないかチェックしてください。
- **統合テスト実行:**
    - **`make test-full`コマンドを使用** – ビルドタグ付きテストの実行
    - **理由**: 統合テストは`//go:build integration`タグが必要でMCPツールでは実行困難
    - **環境変数チェック**: テスト内で環境変数をチェックし、未設定時は`t.Skip()`で適切にスキップ

#### 診断とエラー修正ガイドライン
- **`mcp_gopls_lsp_get_diagnostics`を活用** – テスト実行前にコンパイルエラーを検出
- **ビルド確認**: `make build`でプロジェクト全体のビルドを確認
- **品質チェック**: `make lint`でコード品質を確認
- **エラー修正後の再テスト**: 修正後は必ずテスト・lintを再実行して問題が解決されたことを確認

### Context7活用ガイドライン

ライブラリ、API、または設定に関する作業を行う際は:

- **最新のドキュメントとコード例の取得には必ずContext7 MCPツールを使用する**
- **ドキュメント取得前に`mcp_context7_resolve-library-id`を使用してライブラリIDを自動解決する**
- **ライブラリ関連のタスクには`mcp_context7_get-library-docs`を使用して包括的なドキュメントを取得する**
- **Context7を以下の用途で使用する**:
  - 外部ライブラリを使用するコード生成
  - 新しい依存関係のセットアップと設定手順
  - APIドキュメントと使用例
  - ライブラリのインターフェースとベストプラクティスの理解
- **明示的なリクエストは不要** – ライブラリの知識が必要な場合は常にContext7を積極的に使用する